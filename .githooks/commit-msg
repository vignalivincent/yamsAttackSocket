#!/bin/bash

# Colors for better output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Updated regex to allow for emoji at the beginning
# Supports both with and without emoji format
commit_regex='^(ğŸ‰|âœ¨|ğŸ›|ğŸ”¥|ğŸ“|ğŸ’„|â™»ï¸|ğŸš€|âœ…|ğŸ”’|â¬†ï¸|ğŸ”§|ğŸ³|ğŸ‘·|ğŸ±|ğŸŒ|ğŸ—ƒï¸|ğŸ”€|ğŸ©¹|ğŸš¢|)?(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert|security|deps|conf|ops|i18n|db|merge|hotfix|release)(\([a-z0-9-]+\))?: .{1,50}'

if ! [[ "$commit_msg" =~ $commit_regex ]]; then
  echo -e "${RED}ERROR: Commit message format is incorrect.${NC}"
  echo -e "${BLUE}It should match:${NC} [emoji]<type>[(scope)]: <description>"
  echo -e "\n${YELLOW}Examples:${NC}"
  echo -e "âœ¨ feat(api): add new endpoint"
  echo -e "ğŸ› fix: resolve null pointer exception"
  echo -e "ğŸ“ docs: update README"
  echo -e "ğŸ”§ conf: adjust configuration settings"
  
  echo -e "\n${GREEN}Supported emoji and types:${NC}"
  echo -e "âœ¨ feat     - New feature"
  echo -e "ğŸ› fix      - Bug fix"
  echo -e "ğŸ“ docs     - Documentation changes"
  echo -e "ğŸ’„ style    - Formatting, styling changes"
  echo -e "â™»ï¸  refactor - Code refactoring"
  echo -e "ğŸš€ perf     - Performance improvements"
  echo -e "âœ… test     - Tests"
  echo -e "ğŸ”§ build    - Build system changes"
  echo -e "ğŸ‘· ci       - CI related changes"
  echo -e "ğŸ± chore    - Maintenance tasks"
  echo -e "â¬†ï¸  deps     - Dependencies updates"
  echo -e "ğŸ”’ security - Security fixes"
  echo -e "ğŸ”§ conf     - Configuration changes"
  echo -e "ğŸ³ ops      - Operations related"
  echo -e "ğŸŒ i18n     - Internationalization"
  echo -e "ğŸ—ƒï¸  db       - Database related"
  echo -e "ğŸ”€ merge    - Merge branches"
  echo -e "ğŸ©¹ hotfix   - Critical hotfixes"
  echo -e "ğŸš¢ release  - Releases"
  
  exit 1
fi

echo -e "${GREEN}Commit message format is correct!${NC}"
exit 0
