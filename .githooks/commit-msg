#!/bin/bash

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Simplified regex with basic emoji handling
commit_regex='^[[:space:]]*([-_a-zA-Z0-9â¤ï¸âœ¨ğŸ›ğŸ”¥ğŸ“ğŸ’„â™»ï¸ğŸš€âœ…ğŸ”’â¬†ï¸ğŸ”§ğŸ³ğŸ‘·ğŸ±ğŸŒğŸ—ƒï¸ğŸ”€ğŸ©¹ğŸš¢]|)[[:space:]]*(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert|security|deps|conf|ops|i18n|db|merge|hotfix|release)(\([a-z0-9-]+\))?:[[:space:]]+.+'

if ! [[ "$commit_msg" =~ $commit_regex ]]; then
  echo "ERROR: Commit message format is incorrect."
  echo "It should match: [emoji]<type>[(scope)]: <description>"
  echo ""
  echo "Examples:"
  echo "âœ¨ feat(api): add new endpoint"
  echo "ğŸ› fix: resolve null pointer exception"
  echo "ğŸ“ docs: update README"
  echo "ğŸ”§ conf: adjust configuration settings"
  
  echo ""
  echo "Supported emoji and types:"
  echo "âœ¨ feat     - New feature"
  echo "ğŸ› fix      - Bug fix"
  echo "ğŸ“ docs     - Documentation changes"
  echo "ğŸ’„ style    - Formatting, styling changes"
  echo "â™»ï¸  refactor - Code refactoring"
  echo "ğŸš€ perf     - Performance improvements"
  echo "âœ… test     - Tests"
  echo "ğŸ”§ build    - Build system changes"
  echo "ğŸ‘· ci       - CI related changes"
  echo "ğŸ± chore    - Maintenance tasks"
  echo "â¬†ï¸  deps     - Dependencies updates"
  echo "ğŸ”’ security - Security fixes"
  echo "ğŸ”§ conf     - Configuration changes"
  echo "ğŸ³ ops      - Operations related"
  echo "ğŸŒ i18n     - Internationalization"
  echo "ğŸ—ƒï¸  db       - Database related"
  echo "ğŸ”€ merge    - Merge branches"
  echo "ğŸ©¹ hotfix   - Critical hotfixes"
  echo "ğŸš¢ release  - Releases"
  
  exit 1
fi

echo "Commit message format is correct!"
exit 0
